<!DOCTYPE html>
<html>
<head>
    <title>Installing Caffe on Ubuntu</title>
<style>
div.container {
    width: 100%;
    border: 1px solid gray;
}

header, footer {
    padding: 1em;
    color: white;
    background-color: black;
    clear: left;
    text-align: center;
}

nav {
    float: left;
    max-width: 160px;
    margin: 0;
    padding: 1em;
}

nav ul {
    list-style-type: none;
    padding: 0;
}
   
nav ul a {
    text-decoration: none;
}

article {
    margin-left: 170px;
    border-left: 1px solid gray;
    padding: 1em;
    overflow: hidden;
}
</style>
</head>
<body>

<div class="container">

<header>
   <h1>Installing Caffe on Ubuntu 14.04.4 LTS</h1>
   <h2>Nvidia GTX 1070</h2>
</header>
  
<nav>
  <ul>
    <li><a href="#ubuntu">Installing Ubuntu</a></li>
    <li><a href="#cudadeb">Installing CUDA</a></li>
    <li><a href="#">Installing CUDNN</a></li>
    <li><a href="#">Installing Caffe</a></li>
  </ul>
</nav>

<article id="ubuntu">
  <h1>Installing Ubuntu</h1>
<p>

STEP 1: Create bootable thumb drive or USB<br>
        Go to BIOS and rearrange boot settings to place liveUSB or liveCD to highest preference<br><br>

STEP 2: Reboot your computer and when you reach the GRUB options, highlight Install Ubuntu and hit 'e'<br>
        Replace the 'quiet splash' string with 'nomodeset'<br><br>

STEP 3: Reboot and select Install Ubuntu option from GRUB menu<br>
        Follow installation - Erase Ubuntu 14.04.4 LTS and reinstall<br>
        Reboot and go to BIOS and rearrange the boot order to push back the liveUSB / liveCD lower in order<br><br>

STEP 4: Reboot and hit ESC before login to into GRUB<br>
        Highlight Ubuntu and hit 'e' again and replace 'quiet splash' string with 'nomodeset'<br>
        Reboot and you should be able to login<br><br>
</p>
</article>

<article id="comp">
  <h1>Verification of GPU Compatibility</h1>
<p>
STEP 1: Verify that your GPU is CUDA compatible
        <blockquote>
        $ lspci | grep -i nvidia
        </blockquote>
STEP 2: Verify that your version of linux is CUDA compatible
        <blockquote>
        $ uname -m && cat /etc/*release<br>
        (x86_64 should confirm that you are running a 64bit OS)
        </blockquote>
STEP 3: Verify that you have GCC installed
        <blockquote>
        $ gcc --version
        </blockquote>
        If you don't have GCC installed, you need to download an appropriate version or install it from the development tools<br><br>
STEP 4: Check the version of the kernel that your system is running
        <blockquote>
        $ uname -r
        </blockquote>
STEP 5: The kernel headers and development packages for the currently running kernel can be installed
        <blockquote>
        $ sudo apt-get install linux-headers-$(uname -r)
        </blockquote>
</p>
</article>



<article id="cudadeb">
  <h1>Installing CUDA via Debian Package</h1>
<p>
STEP 1: To install debian package for CUDA
<blockquote>
        $ `sudo dpkg -i cuda-repo-ubuntu1404-8-0-rc_8.0.27-1_amd64-deb`<br>
        $ `sudo apt-get update`<br>
        $ `sudo apt-get install cuda`
</blockquote>
STEP 2: Reboot the system to load the NVIDIA drivers<br><br>
STEP 3: Set up the development environment by modifiying the PATH and LD_LIBRARY_PATH environment variables
<blockquote>
        $ export PATH=/usr/local/cuda-8.0/bin${PATH:+:${PATH}} <br>
        $ export LD_LIBRARY_PATH=/usr/local/cuda-8.0/lib64\ <br>
                         ${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
</blockquote>
        <i>NOTE:</i> If exporting to .bashrc profile doesn't work, open ~/.bashrc file and add these lines manually<br>
            To find the .bashrc file:
            <blockquote>
                $ cd /home<br>
                $ ls -la ~/ | more
            </blockquote>
                If you cannot find a .bashrc file, create it using
                <blockquote>
                    $ vi ~/.bashrc
                </blockquote>
            Most of the distributions keep a .bashrc file in /etc/skel/<br>
                Copy it into your home directory using
                <blockquote>
                $ cp /etc/skel/.bashrc ~
                </blockquote>

STEP 4: Install samples
<blockquote>
        $ cuda-install-samples-8.0.sh ~<br>
        $ cd ~/NVIDIA_CUDA-8.0_Samples/5_Simulations/nbody<br>
        $ make<br>
        $ ./nbody
</blockquote>
</p>
</article>



<article id="cudarun">
  <h1>Installing CUDA via RUN FILE</h1>
<p>
STEP 1: Disable Nouveau drivers<br>
        a) Create a file blacklist-nouveau.conf at /etc/modprobe.d/blacklist-nouveau.conf with the following contents
        <blockquote>
            blacklist nouveau<br>
            options nouveau modeset=0
        </blockquote>
        b) Regenerate the kernel initramfs
        <blockquote>
            $ sudo update-initramfs -u
        </blockquote>
STEP 2: Reboot into runlevel 3 by temporarily adding the number "3" and the word "nomodeset" to the end of the system's kernel boot parameters.<br><br>
<blockquote>
    $ cd /etc/default<br>
    $ sudo gedit grub<br>
    Set the variable GRUB_CMDLINE_LINUX="3"<br>
    (Once you're done installing CUDA, change this back to "" and update-grub again)<br>
    $ sudo update-grub
</blockquote>
STEP 3: Run installer with implied acceptance of EULA
<blockquote>
        $ `sudo sh cuda_8.0.27_linux.run --silent`</br>
        (I ran it without the silent tag and said NO to installing the driver that comes with CUDA 8.0 and chose to install the driver myself)
</blockquote>


STEP 3A: Install the required NVIDIA driver<br>

STEP 4: Create an xorg.conf file to use the NVIDIA GPU for display
<blockquote>
        $ sudo nvidia-xconfig
</blockquote>
STEP 5: Reboot the system<br><br>
STEP 6: Set up the development environment by modifiying the PATH and LD_LIBRARY_PATH environment variables
<blockquote>
        $ export PATH=/usr/local/cuda-8.0/bin${PATH:+:${PATH}} <br>
        $ export LD_LIBRARY_PATH=/usr/local/cuda-8.0/lib64\<br>
                         ${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
</blockquote>

<i>NOTE:</i><br>
Test the GPU cards to see if the drivers are working correctly<br>
<blockquote>
		$ cat /proc/driver/nvidia/version
</blockquote>
Check the version of the CUDA compiler
<blockquote>
		$ nvcc -V
</blockquote>

STEP 6A: Install GCC using
<blockquote>
		$ sudo apt-get --yes install build-essential
</blockquote>

STEP 7: Install samples
<blockquote>
        $ cuda-install-samples-8.0.sh ~<br>
        $ cd ~/NVIDIA_CUDA-8.0_Samples/5_Simulations/nbody<br>
        $ make<br>
        $ ./nbody
<blockquote>
</p>
</article>


<article id="cudnninstall">
    <h1>Installing CuDNN v5 for CUDA 8.0</h1>
<p>
STEP 1: Download the CuDNN files from NVIDIA<br><br>

STEP 2: Extract all files (I extracted them to my Downloads folder)<br><br>

STEP 3: Verify the folder in which your CUDA installation occured using the following commands:
<blockquote>
    $ which nvcc <br>
    or,<br>
    $ ldconfig -p | grep cuda
</blockquote>

STEP 4: Open the contents of your extracted files, it should contain a folder 'cuda' with two subfolders 'include' and 'lib64'. Move these contents to their respective cuda folders as follows.
<blockquote>
    $ sudo cp -P ~/Downloads/cuda/include/cudnn.h /usr/local/cuda/include<br>
    $ sudo cp -P ~/Downloads/cuda/lib64/* /usr/local/cuda/lib64<br>
    $ sudo chmod a+r /usr/local/cuda/lib64/libcudnn*
</blockquote>
I haven't figured out how to actually verify the successful installation of CuDNN without installing one of the machine learning frameworks (Caffe, TensorFlow etc.) so we'll have to wait till one of them are successfully installed to verify this.
</p>
</article>



<article id="error">
  <h1>Debugging Common Errors</h1>
<p>
1. Error while loading shared libraries: libcudart.so.4: cannot open shared object file: No such file or directory<br>
<blockquote>
        $ export LD_LIBRARY_PATH=/usr/local/cuda-8.0/lib\ ${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}<br>
        or,<br>
        $ sudo ldconfig usr/local/cuda/lib64<br><br>
</blockquote>
2. CURAND_STATUS_LAUNCH_FAILURE<br>
        If you're running an NVIDIA GTX PASCAL card on CUDA 7.5 -> switch to CUDA 8.0. <br><br>
</p>
</article>





<footer>Shreyas Skandan</footer>

</div>

</body>
</html>

